---
import { Icon } from 'astro-icon/components';
import { Image } from 'astro:assets';

import { getPublishedOrUpdatedDate } from '@/modules/common';
import Link from '@/components/Link.astro';
import { ROUTES } from '@/constants/routes';
import { formatDate, formatDateIso } from '@/utils/datetime';

import type { Project } from '@/types/project';

export interface Props {
  project: Project;
}

const { project } = Astro.props;

const { slug, data } = project;
const { title, description, heroImage, heroAlt, publishDate, updatedDate } = data;

const { lastAccessDate, isUpdatedDate } = getPublishedOrUpdatedDate({
  publishDate,
  updatedDate,
});
---

<article>
  <Image
    src={heroImage}
    alt={heroAlt}
    widths={[320, 540, 720]}
    sizes="(max-width: 475px) 320px, (max-width: 720px) 540px, 720px"
    class="rounded-t-box mb-2"
  />

  <h4 class="break-words line-clamp-2 mb-0">
    <Link href={`${ROUTES.PROJECTS}${slug}`} variant="link-heading">
      {title}
    </Link>
  </h4>
  {description && <div class="text-sm text-captions mb-2">{description}</div>}

  <p class="flex items-center gap-1 text-xs text-captions">
    <Icon name={isUpdatedDate ? 'mdi:edit-outline' : 'mdi:access-time'} class="w-4 h-4" />
    <time itemprop="datePublished" datetime={formatDateIso(lastAccessDate)}>
      {formatDate(lastAccessDate)}
    </time>
  </p>
</article>
