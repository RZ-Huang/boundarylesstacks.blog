---
import { getAllProjects } from '@/modules/project';
import List from '@/layouts/List.astro';
import { pickPaginationPropsFromPage } from '@/components/Pagination.astro';
import ProjectList from '@/components/ProjectList.astro';
import { CONFIG } from '@/config';

import type { Metadata } from '@/types/common';
import type { ProjectCollection } from '@/types/project';
import type { GetStaticPathsOptions, Page } from 'astro';

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const sortedProjects = await getAllProjects();

  const pagination = paginate(sortedProjects, { pageSize: CONFIG.PAGE_SIZE });
  pagination.push({ params: { page: '1' }, props: pagination[0].props });
  return pagination;
}

type Props = {
  page: Page<ProjectCollection>;
};

const { page } = Astro.props;
const { data: projects } = page;

const paginationProps = pickPaginationPropsFromPage(page);
const metadata: Metadata = {
  title: 'Projects',
  description: 'A showcase of experiments and projects.',
};

const layoutProps = { metadata, paginationProps };
---

<List {...layoutProps}>
  <ProjectList {projects} />
</List>
