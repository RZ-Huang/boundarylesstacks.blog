---
import { getAllPosts, getPostsWithReadingTimeFromPosts } from '@/modules/post';
import List from '@/layouts/List.astro';
import PostList from '@/components/PostList.astro';
import { pageMetadata } from '@/constants/metadata';
import { CONFIG } from '@/config';
import { pickPaginationPropsFromPage } from '@/utils/pagination';
import { getDefaultOpenGraphImagePath } from '@/utils/paths';

import type { Metadata } from '@/types/common';
import type { Post } from '@/types/post';
import type { GetStaticPathsOptions } from 'astro';

// [page].astro and getStaticPaths because of pagination
export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const sortedPosts = await getAllPosts();

  const posts: Post[] = await getPostsWithReadingTimeFromPosts(sortedPosts);

  const pagination = paginate(posts, { pageSize: CONFIG.PAGE_SIZE }); // must take entire config here, interesting
  pagination.push({ params: { page: '1' }, props: pagination[0].props });
  return pagination;
}

// page from pagination
const { page } = Astro.props;
const { data: posts } = page;

const paginationProps = pickPaginationPropsFromPage(page);

const path = 'lists/blog';
const image = getDefaultOpenGraphImagePath(path);
const metadata: Metadata = { ...pageMetadata[path], image };

const layoutProps = { metadata, paginationProps };
---

<List {...layoutProps}>
  <PostList posts={posts} />
</List>
